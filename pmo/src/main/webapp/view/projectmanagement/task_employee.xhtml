<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:outputScript name="plugins/managerow/managerow.js" />

<h:body>

	<ui:composition template="/view/template/templatewithoutjquery.xhtml">
		<ui:define name="title">Gestion des tâches</ui:define>

		<ui:define name="body">

			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper">
				<!-- Content Header (Page header) -->
				<section class="content-header" style="margin-left:-230px">
				<h1>Gestion des tâches</h1>
				<ol class="breadcrumb">
					<li><a href="./user/home"><i class="fa fa-dashboard"></i>
							Home</a></li>
					<li class="active">Affectation des tâches</li>
				</ol>
				</section>

				<!-- Main content -->
				<section class="content" style="margin-left:-230px"> <!-- Small boxes (Stat box) -->
				<!-- Main row -->
				
				<p:tabView value="#{projectController.projects}" var="project"
									scrollable="true" 
									styleClass="text-family" id="tabViewProject"
									dynamic="false">
				<p:tab title="Projet - #{project.name}">
					
						<div class="row">
							<!-- right col -->
							<section class="col-lg-7 connectedSortable">
								<div class="box">
									<div class="box-header">
										<h3 class="box-title">
											<i class="fa fa-th"> </i> Tâches employées
										</h3>
									</div>
									<div class="box-body">
										<div class="input-group margin">
					
					
											<h:form>
												<p:dataTable value="#{taskController.getTasksOfProject(project)}" var="task" widgetVar="50"
													styleClass="table table-bordered text-family" editable="true">
													<p:ajax event="rowEdit"
														listener="#{taskController.onEditTask}" />
													<p:ajax event="rowEditCancel"
														listener="#{taskController.onCancelTask}" />
					
					
					
													<p:column headerText="Nom">
														<h:outputText value="#{task.projectTask.name}" />
													</p:column>
													
													<p:column headerText="Employee">
														<h:outputText value="#{task.employee.firstname} #{task.employee.lastname}" />
													</p:column>
					
													<p:column>
														<f:facet name="header">
															<h:outputText value="Coût" />
														</f:facet>
														<p:cellEditor>
															<f:facet name="output">
																<h:outputText value="#{task.cost}" />
															</f:facet>
															<f:facet name="input">
																<h:inputText
																	styleClass="form-control #{component.valid ? '' : 'has-error'}"
																	value="#{task.cost}" required="true" name="cost0"
																	placeholder="Coût">
																</h:inputText>
															</f:facet>
														</p:cellEditor>
													</p:column>
													
													<p:column>
														<f:facet name="header">
															<h:outputText value="Coût déjà utilisé (JH)" />
														</f:facet>
														<p:cellEditor>
															<f:facet name="output">
																<h:outputText value="#{task.mandayUsed}" />
															</f:facet>
															<f:facet name="input">
																<h:inputText
																	styleClass="form-control #{component.valid ? '' : 'has-error'}"
																	value="#{task.mandayUsed}" required="true" name="cost1"
																	placeholder="Coût déjà utilisé (JH)">
																</h:inputText>
															</f:facet>
														</p:cellEditor>
													</p:column>
													
													<p:column>
														<f:facet name="header">
															<h:outputText value="Date de début" />
														</f:facet>
														<p:cellEditor>
															<f:facet name="output">
																<h:outputText value="#{task.dateStart}" />
															</f:facet>
															<f:facet name="input">
																<p:inputMask
																	styleClass="form-control #{component.valid ? '' : 'has-error'}"
																	value="#{task.dateStart}" mask="99/99/9999" required="true"
																	name="dstart1" placeholder="dd/MM/aaaa">
																	<f:convertDateTime pattern="dd/MM/yyyy" />
																</p:inputMask>
															</f:facet>
														</p:cellEditor>
													</p:column>
													
													<p:column>
														<f:facet name="header">
															<h:outputText value="Date de fin estimée" />
														</f:facet>
														<p:cellEditor>
															<f:facet name="output">
																<h:outputText value="#{task.dateEnd}" />
															</f:facet>
															<f:facet name="input">
																<p:inputMask
																	styleClass="form-control #{component.valid ? '' : 'has-error'}"
																	value="#{task.dateEnd}" mask="99/99/9999" required="true"
																	name="dend1" placeholder="dd/MM/aaaa">
																	<f:convertDateTime pattern="dd/MM/yyyy" />
																</p:inputMask>
															</f:facet>
														</p:cellEditor>
													</p:column>
					
													<p:column headerText="Options">
														<p:rowEditor />
													</p:column>
					
												</p:dataTable>
					
												<p:panelGrid columns="2" styleClass="text-family">
													<h:outputLabel for="projetTasks">Tâches à affecter avec coût encore disponible</h:outputLabel>
													<h:selectOneListbox id="projetTasks"
														value="#{taskController.task.projectTask}" name="projetTasks"
														styleClass="form-control #{component.valid ? '' : 'has-error'}"
														converter="com.pmo.ProjectTaskConverter">
														<f:selectItems value="#{project.projectTasks}"
															var="projectTask" itemLabel="#{projectTask.name}"
															/>
														<f:converter converterId="com.pmo.ProjectTaskConverter" />	
													</h:selectOneListbox>
													
													<h:outputLabel for="employeeTask">Employée à affecter</h:outputLabel>
													<h:selectOneListbox id="employeeTask"
														value="#{taskController.task.employee}" name="employeeTask"
														styleClass="form-control #{component.valid ? '' : 'has-error'}"
														>
														<f:selectItems value="#{project.employees}"
															var="employee" itemLabel="#{employee.firstname} #{employee.lastname}"
															itemValue="#{employee}" />
														<f:converter converterId="com.pmo.EmployeeConverter" />
													</h:selectOneListbox>
													
													<h:outputLabel for="taskstart" value="Date de début: " />
													<p:inputMask id="taskstart"
														styleClass="form-control #{component.valid ? '' : 'has-error'}"
														value="#{taskController.task.dateStart}" mask="99/99/9999"
														required="true" name="taskstart" placeholder="dd/MM/aaaa">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</p:inputMask>
													<h:outputLabel for="taskend" value="Date de fin: " />
													<p:inputMask id="taskend"
														styleClass="form-control #{component.valid ? '' : 'has-error'}"
														value="#{taskController.task.dateEnd}" mask="99/99/9999"
														required="true" name="taskend" placeholder="dd/MM/aaaa">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</p:inputMask>
												
													<h:outputLabel for="taskcost" value="Coût (JH):" />
													<p:inputText id="taskcost"
														value="#{taskController.task.cost}" required="true"/>
													<h:outputLabel for="taskManDay" value="Coût (JH) déjà utilisé :" />
													<p:inputText id="taskManDay"
														value="#{taskController.task.mandayUsed}" required="true"/>	
													<f:facet name="footer">
														<p:commandButton id="addButtonTask"
															value="Ajouter la tâche affectée"
															actionListener="#{taskController.addTask()}"
															update="tabViewProject" />
													</f:facet>
												</p:panelGrid>
											</h:form>
					
					
										</div>
									</div>
								</div>
							</section>
						</div>
						<!-- /.row -->

				</p:tab>
				</p:tabView>
				</section>

			</div>
			<!-- /.content-wrapper -->

		</ui:define>
	</ui:composition>

</h:body>
</html>