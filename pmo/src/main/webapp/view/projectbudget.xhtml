<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:outputScript name="plugins/managerow/managerow.js" />

<h:body>

	<ui:composition template="/view/template/templatewithoutjquery.xhtml">
		<ui:define name="title">Gestion du budget</ui:define>

		<ui:define name="body">

			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper">
				<!-- Content Header (Page header) -->
				<section class="content-header" style="margin-left:-230px">
				<h1>Gestion du budget</h1>
				<ol class="breadcrumb">
					<li><a href="./user/home"><i class="fa fa-dashboard"></i>
							Home</a></li>
					<li class="active">Gestion du budget</li>
				</ol>
				</section>

				<!-- Main content -->
				<section class="content" style="margin-left:-230px"> <!-- Small boxes (Stat box) -->
				<!-- Main row -->
				<div class="row">
					<!-- Left col -->
					<section class="col-lg-7 connectedSortable">

					<div class="box">
						<div class="box-body">
							<div class="input-group margin">
								<span class="input-group-btn"> <h:link
										outcome="/view/newProject.jsf">
										<button type="button" class="btn btn-success btn-flat">Créer
											un projet</button>
									</h:link>
								</span>
							</div>

						</div>
					</div>
					</section>
				</div>
				<div class="row">
					<!-- right col -->
					<section class="col-lg-5 connectedSortable">
					<div class="box">
						<div class="box-header">
							<h3 class="box-title">
								<i class="fa fa-th"> </i> Phases
							</h3>
						</div>
						<div class="box-body">
							<div class="input-group margin">
								<p:tabView value="#{projectController.projects}" var="project"
									scrollable="true" style="width: 1280px;"
									styleClass="text-family" id="tabViewProject">
									<p:tab title="Projet - #{project.name}">
										<h:form id="projectform_#{project.id}">
											<p:dataTable value="#{project.phases}" var="phase" widgetVar="50" styleClass="table table-bordered text-family" editable="true">
												<p:ajax event="rowEdit"
													listener="#{projectController.onEditPhase}" />
												<p:ajax event="rowEditCancel"
													listener="#{projectController.onCancelPhase}" />

												<p:column>
													<f:facet name="header">
														<h:outputText value="Nom" />
													</f:facet>
													<p:cellEditor>
														<f:facet name="output">
															<h:outputText value="#{phase.name}" />
														</f:facet>
														<f:facet name="input">
															<h:inputText
																styleClass="form-control #{component.valid ? '' : 'has-error'}"
																value="#{phase.name}" required="true" name="name0"
																placeholder='Nom'>
																<f:validateLength minimum="2" maximum="50" />
															</h:inputText>
														</f:facet>
													</p:cellEditor>
												</p:column>

												<p:column>
													<f:facet name="header">
														<h:outputText value="Coût" />
													</f:facet>
													<p:cellEditor>
														<f:facet name="output">
															<h:outputText value="#{phase.cost}" />
														</f:facet>
														<f:facet name="input">
															<h:inputText
																styleClass="form-control #{component.valid ? '' : 'has-error'}"
																value="#{phase.cost}" required="true" name="cost0"
																placeholder="Coût">
																<f:validateRegex pattern="[0-9]+" />
															</h:inputText>
														</f:facet>
													</p:cellEditor>
												</p:column>

												<p:column>
													<f:facet name="header">
														<h:outputText value="Date de début" />
													</f:facet>
													<p:cellEditor>
														<f:facet name="output">
															<h:outputText value="#{phase.start}" />
														</f:facet>
														<f:facet name="input">
															<p:inputMask
																styleClass="form-control #{component.valid ? '' : 'has-error'}"
																value="#{phase.start}" mask="99/99/9999" required="true"
																name="dstart0" placeholder="dd/MM/aaaa">
																<f:convertDateTime pattern="dd/MM/yyyy" />
															</p:inputMask>
														</f:facet>
													</p:cellEditor>
												</p:column>

												<p:column>
													<f:facet name="header">
														<h:outputText value="Date de fin" />
													</f:facet>
													<p:cellEditor>
														<f:facet name="output">
															<h:outputText value="#{phase.end}" />
														</f:facet>
														<f:facet name="input">
															<p:inputMask
																styleClass="form-control #{component.valid ? '' : 'has-error'}"
																value="#{phase.end}" mask="99/99/9999" required="true"
																name="dend0" placeholder="dd/MM/aaaa">
																<f:convertDateTime pattern="dd/MM/yyyy" />
															</p:inputMask>
														</f:facet>
													</p:cellEditor>
												</p:column>

												<p:column headerText="Options" style="width:50px">
													<p:rowEditor />
												</p:column>

											</p:dataTable>

											<p:panelGrid columns="2" styleClass="text-family">
												<h:outputLabel for="phasename" value="Nom de la phase: " />
												<p:inputText id="phasename"
													value="#{phaseController.phase.name}" />
												<h:outputLabel for="phasecost" value="Coût: " />
												<p:inputText id="phasecost"
													value="#{phaseController.phase.cost}" />
												<h:outputLabel for="phasestart" value="Date de début: " />
												<p:inputMask id="phasestart"
													styleClass="form-control #{component.valid ? '' : 'has-error'}"
													value="#{phaseController.phase.start}" mask="99/99/9999"
													required="true" name="phasestart" placeholder="dd/MM/aaaa">
													<f:convertDateTime pattern="dd/MM/yyyy" />
												</p:inputMask>
												<h:outputLabel for="phaseend" value="Date de fin: " />
												<p:inputMask id="phaseend"
													styleClass="form-control #{component.valid ? '' : 'has-error'}"
													value="#{phaseController.phase.end}" mask="99/99/9999"
													required="true" name="phaseend" placeholder="dd/MM/aaaa">
													<f:convertDateTime pattern="dd/MM/yyyy" />
												</p:inputMask>
												<f:facet name="footer">
													<p:commandButton id="addButton_#{project.id}"
														value="Ajouter la phase"
														actionListener="#{phaseController.addPhase(project)}"
														update="tabViewProject" />
												</f:facet>
											</p:panelGrid>
										</h:form>
									</p:tab>
								</p:tabView>

							</div>
						</div>
					</div>
					</section>
				</div>
				<!-- /.row --> <!-- Small boxes (Stat box) -->
				<div class="row">
					<section class="col-lg-5 connectedSortable">
					<div class="box">

						<!-- /.box-header -->
						<div class="box-body">

							<!-- Custom Tabs (Pulled to the right) -->
							<div class="nav-tabs-custom">
								<ul class="nav nav-tabs pull-right">
									<ui:repeat value="#{projectController.project.phases}"
										var="phase" varStatus="status">
									</ui:repeat>

									<li class="pull-left header"><i class="fa fa-th"></i>Calendrier
										par semaine</li>
								</ul>
								<div class="tab-content">
									<ui:repeat value="#{projectController.project.phases}"
										var="phase" varStatus="status">
										<div class="tab-pane active" id="tab_1-#{status.index}">
											<table id="example#{status.index}"
												class="table table-bordered table-striped">
												<!-- TODO afficher les semaines pour chaque phase ainsi que les collaborateurs associés au projet
												+ les charges sur chaque semaine
												+ vérifier que la somme des charges du collaborateur ne dépasse pas son temps de présence
												+ vérifier que la somme des charges < cout de la phase
												+ ajouter la possibilité de modifier les charges dans la page
												http://www.mkyong.com/jsf2/how-to-update-row-in-jsf-datatable/
												  -->
												<thead>
													<tr>
														<th>Collaborateur</th>
														<th>S1</th>
														<th>S2</th>
														<th>S3</th>
														<th>S4</th>
													</tr>
												</thead>
												<tbody>
													<tr>
														<td>Bob</td>
														<td>2</td>
														<td>5</td>
														<td>4</td>
														<td>1</td>
													</tr>
												</tbody>
												<tfoot>
													<tr>
														<th>Collaborateur</th>
														<th>S1</th>
														<th>S2</th>
														<th>S3</th>
														<th>S4</th>
													</tr>
												</tfoot>
											</table>
										</div>
										<!-- /.tab-pane -->
									</ui:repeat>
								</div>
								<!-- /.tab-content -->
							</div>
							<!-- nav-tabs-custom -->
						</div>
						<!-- /.box-body -->
					</div>
					</section>
				</div>
				</section>

			</div>
			<!-- /.content-wrapper -->

		</ui:define>
	</ui:composition>

</h:body>
</html>